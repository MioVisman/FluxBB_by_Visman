// media.js v2.7.8 Copyright (C) 2013-2023 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(p,F,G){function w(b,f,e){try{var a=new XMLHttpRequest}catch(d){return}a.open("GET",b,!0);a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){var d=a.responseText;if("string"===typeof d)try{d=JSON.parse(d)}catch(g){e&&e(g);return}"width"in d&&"height"in d&&"html"in d?f&&f(d):e&&e(d)}else e&&e(a)};a.send()}function z(b,f,e){var a,d="",g=p.createElement(b);if(g.canPlayType){for(a=0;a<f.length;a++)""!==g.canPlayType(b+"/"+e[a])&&(x[f[a]]=b+"/"+e[a],d+=(d?"|":"")+f[a]);return d?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+d+")$","i"):!1}return!1}function r(b,f,e,a,d){e=e||{};a=a||{};var g,c="video"===f||"audio"===f;f=p.createElement(f);for(var l in e)e.hasOwnProperty(l)&&("style"==l?f.style.cssText=e[l]:f.setAttribute(l,e[l]));c&&(g=p.createElement("source"));for(l in a)a.hasOwnProperty(l)&&(c?g.setAttribute(l,a[l]):(g=p.createElement("param"),g.setAttribute("name",l),g.setAttribute("value",a[l]),f.appendChild(g)));c&&f.appendChild(g);if(!d)return b.appendChild(f);e=b.parentNode;return(b=b.nextSibling)?e.insertBefore(f,b):e.appendChild(f)}function t(b){return"string"===typeof b&&/^(?:100|[1-9]\d(?:\.\d{1,2})?)%$/.test(b)?3:0!==b%1?0:15<b?2:1>b?1:0}function k(b,f,e,a,d){var g={style:"padding-top:5px;overflow:hidden;position:relative;"};a=a||"iframe";d=d||{};"iframe"===a&&(f.frameborder="0",f.scrolling="no",f.allowfullscreen||(f.allowfullscreen="allowfullscreen"));e=e||[640,360];var c=t(e[0]);var l=t(e[1]);if(0!==c&&0!==l){1<c&&(g.style+=3===c?"width:"+e[0]+";":"max-width:"+e[0]+"px;");if(3===c&&2===l){var q={style:"overflow:hidden;position:relative;height:"+e[1]+"px;"};f.style="width:100%;height:"+e[1]+"px;"}else 1<c&&1<l?(q={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+(3===l?e[1]:100*e[1]/e[0]+"%;")},f.style="position:absolute;left:0;top:0;width:100%;height:100%;"):1<c&&(f.style="width:100%;");++u;f.id="mediajs"+u;b.classList.add("mediajslink");b=r(b,"div",g,{},!0);q&&(b=r(b,"div",q));A&&"div"!==a?(b.classList.add("mediajslazy"),b.setAttribute("data-lazyid",u),B[u]={type:a,attr:f,param:d},y||(y=new IntersectionObserver(function(v,h){v.forEach(function(n){if(n.isIntersecting){n=n.target;var m=B[n.dataset.lazyid];r(n,m.type,m.attr,m.param);n.classList.remove("mediajslazy");h.unobserve(n)}})})),y.observe(b)):r(b,a,f,d);return!0}}function H(b){return/^\d+$/.test(b)?b:(b=b.match(/^((\d{1,2})h)?((\b\d{1,3}|\d{1,2})m)?((\b\d{1,5}|\d{1,2})s)?$/))?3600*(b[2]||0)+60*(b[4]||0)+1*(b[6]||0):""}function I(b,f){"z"!=f&&(b=Math.log(704E5/b)/Math.log(2));return Math.min(18,Math.max(Math.round(b),3))}function J(b){function f(h,n,m){k(h,{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url=https%3A//"+n},m||["100%",/\/playlists\//.test(n)?450:166])}var e=b.href,a=e.match(/^(.+)(?:#|%23)(\d+(?:\.\d{1,2})?)(%|%25)?(?::|%3A)(\d+(?:\.\d{1,2})?)(%|%25)?$/),d;if(a){b.href=e=a[1];var g=a[2]+(a[3]?"%":"");var c=a[4]+(a[5]?"%":"");0<t(g)&&0<t(c)&&(d=[g,c])}(a=e.split(/re\.php?.*?\bu=/))&&a[1]&&(e=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));e=e.replace(/&amp;/g,"&");if(g=e.match(/^(https?:\/\/)(www\.)?(.+)$/))if(c=g[3],g[4]="https:"==p.location.protocol?"https://":g[1],a=c.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var l=["wmode=transparent"],q=[];e="https://www.youtube.com/embed";if(a[1]){e+="/"+a[1];var v="start t end list rel loop".split(" ")}else l.push("listType=playlist"),v=["list","index","loop"],q=["list"];for(g=c.split(/[\?&#]/);c=g.shift();)c=c.split("="),c[0]&&c[1]&&-1<v.indexOf(c[0])&&/^[\w-]+$/.test(c[1])&&("start"==c[0]||"t"==c[0]||"end"==c[0]?l.push(("end"==c[0]?"end":"start")+"="+H(c[1])):(l.push(c[0]+"="+c[1]),"loop"==c[0]&&"1"==c[1]&&a[1]&&l.push("playlist="+a[1])),c=q.indexOf(c[0]),-1<c&&q.splice(c,1));q.length||k(b,{src:e+"?"+l.join("&")},d)}else(a=c.match(/^(?:player\.)?vimeo\.com\/(?:[^\s\/<>'"]+\/){0,3}(?:\d+)(?=\?|#|$)/))?w("https://vimeo.com/api/oembed.json?url=https%3A//"+a[0],function(h){if(h.m=h.html.match(/<iframe [^>]*?src=["']([^"'<>]+)["']/)){var n={src:h.m[1]},m;(m=d)||(h.width&&h.height?(m=1,h.width<h.height?480>h.height?m=480/h.height:640<h.height&&(m=640/h.height):640<h.width?m=640/h.width:480>h.height&&(m=Math.min(640/h.width,480/h.height)),m=[Math.floor(h.width*m),Math.floor(h.height*m)]):m=void 0);k(b,n,m)}}):(a=c.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?k(b,{src:g[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"'},d):(a=c.match(/^(?:video\.rutube\.ru|rutube\.ru\/(?:video(?:\/embed)?|play\/embed))\/([a-f\d]+)(?=\/|\?|#|$)\/?(?:\?t=(\d+))?/))?k(b,{src:"https://rutube.ru/play/embed/"+a[1]+(a[2]?"?t="+a[2]:"")},d):(a=c.match(/^api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))?f(b,a[0],d):(a=c.match(/^soundcloud\.com\/[\w-]+\/(?:sets\/)?[\w-]+/))?w("https://soundcloud.com/oembed?format=json&url=https%3A//"+a[0],function(h){(h.m=h.html.replace(/%2F/g,"/").match(/api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))&&f(b,h.m[0],d)}):(a=c.match(/^(www\d+)\.zippyshare\.com\/v\/(\w+)\//))?k(b,{src:g[4]+"api.zippyshare.com/api/jplayer_embed.jsp?key="+a[2]+"&server="+a[1]+"&width=100%"},d||["100%",92]):(a=c.match(/^video\.sibnet\.ru\/[^\?&]*?video(\d+)/))?k(b,{src:g[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/"},d):(a=c.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?k(b,{src:g[4]+"promodj.com/embed/"+a[1]+"/big"},d||["100%",70]):(a=c.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?k(b,{src:g[4]+"widgets.ign.com/video/embed/content.html?url=https://www."+a[1]},d):(a=c.match(/^([a-z]+\.)?gamespot\.com\/(?:video(?:s|embed)?|[\w\/-]+\/videos?)(?=\/)[^\?&#]*[\/-](\d{7,})\//))?(c=c.split("?"),c=c[1]?c[1].replace(/&?autoplay=[^&]*/g,"").replace(/^&/,""):!1,k(b,{src:"https://www.gamespot.com/videos/embed/"+a[2]+"/"+(c?"?"+c:"")},d)):C&&(a=c.match(C))?k(b,{controls:!0,preload:"metadata",controlsList:"nodownload"},d||["100%",0],"audio",{src:g[1]+(g[2]?g[2]:"")+a[1]+a[2],type:x[a[2].toLowerCase()]}):D&&(a=c.match(D))?k(b,{controls:!0,preload:"metadata",controlsList:"nodownload"},d,"video",{src:g[1]+(g[2]?g[2]:"")+a[1]+a[2],type:x[a[2].toLowerCase()]}):(a=c.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?k(b,{src:g[4]+"www.hulkshare.com/embed.php?fn="+a[1]},d||["100%",160]):(a=c.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?k(b,{src:g[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]},d||["100%",120]):(a=c.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?k(b,{src:g[4]+a[1]},d):(a=c.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?k(b,{src:"https://coub.com/embed/"+a[1]+"?muted=false&autostart=false&originalSize=false"},d):(a=c.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?k(b,{src:"https://vine.co/v/"+a[1]+"/embed/simple"},d||[360,360]):(a=c.match(/^(?:(?:m\.)?facebook\.com|fb\.watch)\/[^<>'"]+$/))?(E=!0,d=d||[500,0],k(b,{"class":"fb-post","data-href":"https://"+a[0],"data-width":d[0]},d,"div")):(a=c.match(/^(?=[^\/]*\byandex\.([a-z]+)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w~\-]+)$/))?k(b,{src:"https://api-maps.yandex."+("ru"==a[1]||"by"==a[1]?"ru":"com")+"/frame/v1/-/"+a[2]},d||[410,350]):(a=c.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,&=]+)$/))?k(b,{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"},d||[410,350]):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?k(b,{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]},d||[410,350]):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?k(b,{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z="+I(a[5],a[6])+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"},d||[410,350]):(a=c.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))?k(b,{src:"https://ok.ru/videoembed/"+a[1]},d):(a=c.match(/^aparat\.com\/(?:v|embed)\/(\w+)/))?k(b,{src:"https://www.aparat.com/video/video/embed/videohash/"+a[1]+"/vt/frame"},d):(a=c.match(/^audiomack\.com\/(?:embed\/)?([\w-]+)\/([\w-]+)\/([\w-]+)/))?(/^(playlist|song|album)$/.test(a[1])&&(c=a[2],a[2]=a[1],a[1]=c),/^(playlist|song|album)$/.test(a[2])&&k(b,{src:"https://audiomack.com/embed/"+a[1]+"/"+a[2]+"/"+a[3]+"?background=1"},d||["100%","song"===a[2]?252:400])):(a=c.match(/^izlesene\.com\/(?:embedplayer|video\/[^\/]+)\/(\d+)/))?k(b,{src:"https://www.izlesene.com/embedplayer/"+a[1]+"/?showrel=0&loop=0&autoplay=0&autohide=1&showinfo=1&socialbuttons=1&annotation=&volume=0.5"},d):(a=c.match(/^hearthis\.at\/(?!(?:categories|maps)\/)[\w\.-]+\/(?:set\/)?[\w\.-]+\//))?w("https://hearthis.at/oembed/?format=json&url=https%3A//"+a[0],function(h){(h.m=h.html.match(/<iframe [^>]*?src=["']([^"'<>]+)["']/))&&k(b,{src:h.m[1]},d||[h.width,h.height])}):(a=c.match(/^(?:vlp\.to\/|vlipsy\.com\/(?:vlip\/[\w-]+-|embed\/))([a-zA-Z\d]{8})$/))?k(b,{src:"https://vlipsy.com/embed/"+a[1]},d):(a=c.match(/^iz\.ru\/(?:(\d+)\/video\/|video\/embed\/(\d+)$)/))?k(b,{src:"https://iz.ru/video/embed/"+(a[1]||a[2])},d):(a=c.match(/^t\.me\/([\w-]+\/\d+)$/))?k(b,{src:"https://telegram.org/js/telegram-widget.js?18","data-telegram-post":a[1],"data-width":"100%"},d||[0,0],"script"):(a=c.match(/^music.yandex.ru\/(?:iframe\/#)?album\/(\d+)/))&&k(b,{src:"https://music.yandex.ru/iframe/#album/"+a[1]},d||["100%",450])}var u=0,x={},C=z("audio","mp3 m4a ogg oga webma wav flac".split(" "),"mpeg mp4 ogg ogg webm wav flac".split(" ")),D=z("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]),A=!1,B=[],y,E=!1;return{run:function(){var b;if(!(b=p.querySelectorAll("#brd-main .entry-content"))||!b.length)if(!(b=p.querySelectorAll(".postmsg"))||!b.length)return;"IntersectionObserver"in F&&!/Googlebot|YandexBot/.test(G.userAgent)&&(A=!0);for(var f in b)if(b[f].className&&!b[f].classList.contains("postsignature")){var e=b[f].getElementsByTagName("a"),a;for(a in e)if(e[a].href&&(!e[a].nextSibling||e[a].nextSibling.tagName&&"BR"==e[a].nextSibling.tagName.toUpperCase())&&(!e[a].previousSibling||e[a].previousSibling.tagName&&"BR"==e[a].previousSibling.tagName.toUpperCase())&&"P"==e[a].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(e[a].innerHTML)){for(var d=e[a].parentNode;d!==b[f]&&"BLOCKQUOTE"!==d.tagName.toUpperCase();)d=d.parentNode;d===b[f]&&J(e[a])}}E&&r(p.body,"script",{crossOrigin:"anonymous",async:!0,defer:!0,src:"https://connect.facebook.net/ru_RU/sdk.js#xfbml=1&version=v15.0"})},init:function(){p.addEventListener&&"undefined"!==typeof DOMTokenList&&p.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1)}}}(document,window,navigator);FluxBB.media.init();
